# 图片路径使用说明

## ✅ 问题完美解决

模板现在采用了全新的架构，**彻底解决了图片路径解析问题**！

## � 解决方案

### 核心原理

1. **在主文件中加载图片**：使用 `image()` 函数在主文件中直接加载图片
2. **传递图片内容**：将已加载的图片内容传递给模板函数
3. **模板只处理内容**：模板函数不再处理路径字符串，只处理图片内容

### 正确用法

```typst
#import "@local/image-ppt:0.0.1": *

// ✅ 在主文件中加载图片 (路径相对于主文件解析)
#let img1 = image("images/setup.png")
#let img2 = image("data/result.png")
#let img3 = image("../shared/chart.png")

#four-image-page(
  title: "实验结果",
  images: (img1, img2, img3, none),  // 传递已加载的图片内容
  captions: ("装置图", "结果图", "图表", "")
)
```

### 简化写法

```typst
#four-image-page(
  title: "实验结果",
  images: (
    image("images/pic1.png"),    // 直接在参数中加载
    image("images/pic2.png"),    // 路径从主文件目录解析
    none,                        // 占位符
    image("data/analysis.png")   // 支持不同目录
  )
)
```

## 🖼️ 页面显示控制

### 页眉页脚控制

```typst
// 隐藏页眉页脚，图片自动放大
#four-image-page(
  title: "大图展示",
  show-header: false,  // 隐藏页眉
  show-footer: false,  // 隐藏页脚
  images: (
    image("images/large1.png"),
    image("images/large2.png"),
    none,
    none
  )
)
```

### 全屏图片模式

```typst
// 完全全屏：无页眉页脚、无标题、无内容
#four-image-page(
  show-header: false,
  show-footer: false,
  title: none,       // 无标题
  content: none,     // 无额外内容
  images: (
    image("images/pic1.png"),
    image("images/pic2.png"),
    image("images/pic3.png"),
    image("images/pic4.png")
  ),
  captions: ("", "", "", "")  // 无说明文字
)
```

### 动态尺寸计算

- **全屏模式**：图片填满整个页面（45%×45%网格 或 80%×90%线性）
- **无边框模式**：图片放大但保留标题空间（40%×40%网格 或 70%×80%线性）
- **标准模式**：标准尺寸（35%×40%网格 或 60%×80%线性）

## 🎯 支持的路径类型

### 1. 相对路径（推荐）
```typst
image("images/pic.png")          // 同级images目录
image("data/chart.png")          // 同级data目录  
image("../parent/file.png")      // 父目录
image("subdir/nested/pic.png")   // 嵌套子目录
```

### 2. 绝对路径
```typst
image("C:/Users/用户名/Documents/project/images/pic.png")
image("e:/研究/实验数据/图片/result.png")
```

## 📚 实用技巧

### 1. 批量定义图片
```typst
// 定义图片变量
#let setup = image("images/setup.png")
#let result1 = image("images/result1.png")
#let result2 = image("images/result2.png")
#let analysis = image("images/analysis.png")

// 批量使用
#four-image-page(
  images: (setup, result1, result2, analysis)
)
```

### 2. 条件加载
```typst
// 根据条件选择不同图片
#let use-hd = true
#let pic = if use-hd {
  image("images/hd/pic.png")
} else {
  image("images/sd/pic.png")  
}

#four-image-page(images: (pic, none, none, none))
```

### 3. 创建图片库
```typst
// 定义图片库函数
#let img(name) = image("images/" + name + ".png")

// 简化使用
#four-image-page(
  images: (
    img("setup"),
    img("measurement"), 
    img("analysis"),
    img("conclusion")
  )
)
```

## 🔧 自定义布局用法

```typst
// 加载图片
#let logo = image("assets/logo.png")
#let chart = image("data/chart.png")

#custom-layout-page(
  title: "自定义布局",
  images: (
    (content: logo, x: 10%, y: 20%, width: 20%, caption: "Logo"),
    (content: chart, x: 60%, y: 20%, width: 30%, caption: "图表"),
  )
)
```

## 🎨 标题页logo

```typst
// 加载logo
#let company-logo = image("assets/company-logo.png")

#title-page(
  main-title: "我的演示文稿",
  author: "张三",
  institution: "北京大学",
  logo: company-logo
)
```

## ⚡ 迁移指南

### 旧的架构（有问题）：
```typst
#four-image-page(
  images: ("images/pic1.png", "images/pic2.png")  // ❌ 路径解析错误
)
```

### 新的架构（完美解决）：
```typst
#four-image-page(
  images: (image("images/pic1.png"), image("images/pic2.png"))  // ✅ 完美
)
```

## 🎉 架构优势

1. **路径解析正确**：图片在主文件中加载，路径从主文件目录解析
2. **代码简洁**：不需要绝对路径或特殊函数
3. **性能优秀**：图片只加载一次，可重复使用
4. **错误友好**：图片加载失败时显示占位符，不中断编译
5. **向前兼容**：支持所有现有的模板功能

## 🐛 错误处理

如果图片加载失败，模板会自动显示占位符而不是报错：

```typst
#four-image-page(
  images: (
    image("存在的图片.png"),     // ✅ 正常显示
    image("不存在的图片.png"),   // ✅ 显示占位符
    none,                      // ✅ 显示空白占位符
    image("另一张图片.png")      // ✅ 正常显示
  )
)
```

## 📋 完整示例

```typst
#import "@local/image-ppt:0.0.1": *

// 设置文档
#show: doc => ppt-conf(
  title: "实验报告", 
  author: "张三",
  doc
)

// 标题页
#title-page(
  main-title: "物理实验报告",
  subtitle: "光电效应实验",
  author: "张三",
  institution: "北京大学物理学院",
  logo: image("assets/pku-logo.png")
)

// 标准内容页
#four-image-page(
  title: "实验结果",
  images: (
    image("experiment/setup.png"),
    image("experiment/measurement.png"),
    image("experiment/analysis.png"), 
    image("experiment/conclusion.png")
  ),
  captions: (
    "实验装置",
    "数据测量",
    "结果分析", 
    "实验结论"
  )
)

// 大图展示页（无页眉页脚）
#four-image-page(
  title: "详细数据图表",
  show-header: false,
  show-footer: false,
  images: (
    image("charts/detailed-chart1.png"),
    image("charts/detailed-chart2.png"),
    none,
    none
  ),
  captions: ("详细图表1", "详细图表2", "", "")
)

// 全屏图片页
#four-image-page(
  show-header: false,
  show-footer: false,
  title: none,
  content: none,
  images: (
    image("results/final1.png"),
    image("results/final2.png"),
    image("results/final3.png"),
    image("results/final4.png")
  ),
  captions: ("", "", "", "")
)
```

现在可以愉快地使用相对路径和灵活的页面布局了！🎉
